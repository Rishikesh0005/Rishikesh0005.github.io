<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gift Shuffler</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #0b1220; color: #e8eefc; }
    .wrap { max-width: 720px; margin: 0 auto; padding: 28px 16px 48px; }
    .card {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    h1 { font-size: 22px; margin: 0 0 8px; }
    p { margin: 8px 0 14px; line-height: 1.5; color: rgba(232,238,252,0.85); }
    button, input {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.25);
      color: #e8eefc;
      font-size: 15px;
      outline: none;
    }
    button { margin-top: 12px; background: rgba(99, 102, 241, 0.9); border: 0; cursor: pointer; font-weight: 700; }
    button:hover { filter: brightness(1.05); }
    .result {
      margin-top: 16px;
      padding: 14px;
      border-radius: 14px;
      background: rgba(34,197,94,0.12);
      border: 1px solid rgba(34,197,94,0.25);
    }
    .result strong { font-size: 18px; }
    .danger {
      margin-top: 16px;
      padding: 14px;
      border-radius: 14px;
      background: rgba(239,68,68,0.12);
      border: 1px solid rgba(239,68,68,0.25);
    }
    .muted { color: rgba(232,238,252,0.7); font-size: 13px; margin-top: 10px; }
    code { background: rgba(255,255,255,0.08); padding: 2px 6px; border-radius: 8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>üéÅ Gift Shuffler</h1>
      <p id="intro"></p>

      <!-- Optional PIN gate (turn on/off in JS) -->
      <div id="pinBlock" style="display:none;">
        <input id="pin" placeholder="Enter PIN" inputmode="numeric" />
        <button id="unlock">Unlock</button>
        <div class="muted">PIN is optional (set by organizer).</div>
      </div>

      <button id="reveal" style="display:none;">Reveal my assigned person</button>

      <div id="out"></div>

      <div class="muted" id="hint"></div>
    </div>
  </div>

<script>
/** Your group */
const NAMES = [
  "Duckchin",
  "Dheeksha",
  "Aparna",
  "Rishikesh",
  "Girish Annan Jerish",
  "Mohini"
];

/**
 * Seed controls the "shuffle".
 * Keep this constant after sharing.
 */
const SEED_PHRASE = "gift-2025";

/**
 * Token mapping (what you put in the URL) -> actual name
 * Keep tokens not-too-guessable.
 */
const TOKEN_TO_NAME = {
  "dc9k2": "Duckchin",
  "dh7p1": "Dheeksha",
  "ap4q8": "Aparna",
  "ri1m6": "Rishikesh",
  "gj8t3": "Girish Annan Jerish",
  "mo6v9": "Mohini"
};

/**
 * OPTIONAL PIN protection:
 * Set ENABLE_PIN = true and set per-name pin below.
 * (Still frontend-only; prevents casual peeking, not perfect security.)
 */
const ENABLE_PIN = false;
const NAME_TO_PIN = {
  "Duckchin": "1111",
  "Dheeksha": "2222",
  "Aparna": "3333",
  "Rishikesh": "4444",
  "Girish Annan Jerish": "5555",
  "Mohini": "6666"
};

// --- Seeded shuffle helpers (hash -> PRNG) ---
function xmur3(str) {
  let h = 1779033703 ^ str.length;
  for (let i = 0; i < str.length; i++) {
    h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
    h = (h << 13) | (h >>> 19);
  }
  return function() {
    h = Math.imul(h ^ (h >>> 16), 2246822507);
    h = Math.imul(h ^ (h >>> 13), 3266489909);
    h ^= h >>> 16;
    return h >>> 0;
  };
}
function mulberry32(a) {
  return function() {
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}
function seededShuffle(arr, seedStr) {
  const seed = xmur3(seedStr)();
  const rand = mulberry32(seed);
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(rand() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}
function buildMapping(seedStr) {
  const perm = seededShuffle(NAMES, seedStr);
  const mapping = {};
  for (let i = 0; i < perm.length; i++) {
    mapping[perm[i]] = perm[(i + 1) % perm.length];
  }
  // Safety (rare)
  for (let i = 0; i < perm.length; i++) {
    const n = perm[i];
    if (mapping[n] === n) {
      const swapWith = perm[(i + 1) % perm.length];
      const tmp = mapping[n];
      mapping[n] = mapping[swapWith];
      mapping[swapWith] = tmp;
    }
  }
  return mapping;
}

function escapeHtml(s) {
  return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}
function getToken() {
  return new URL(window.location.href).searchParams.get("t");
}

// --- App logic ---
const intro = document.getElementById("intro");
const out = document.getElementById("out");
const hint = document.getElementById("hint");
const revealBtn = document.getElementById("reveal");
const pinBlock = document.getElementById("pinBlock");
const pinInput = document.getElementById("pin");
const unlockBtn = document.getElementById("unlock");

const token = getToken();
const name = token ? TOKEN_TO_NAME[token] : null;

if (!token || !name) {
  intro.innerHTML = `This link is missing/invalid.<br/>Ask the organizer for your personal link.`;
  out.innerHTML = `<div class="danger">Invalid link. Example format: <code>?t=dc9k2</code></div>`;
  hint.textContent = "";
} else {
  intro.innerHTML = `Hi <b>${escapeHtml(name)}</b> üëã<br/>Tap reveal to see who you should gift.`;

  const mapping = buildMapping(SEED_PHRASE);
  const assigned = mapping[name];

  function showReveal() {
    revealBtn.style.display = "block";
    revealBtn.onclick = () => {
      out.innerHTML = `
        <div class="result">
          You should gift: <strong>${escapeHtml(assigned)}</strong> üéÅ
        </div>
      `;
    };
  }

  if (ENABLE_PIN) {
    pinBlock.style.display = "block";
    unlockBtn.onclick = () => {
      const ok = (pinInput.value || "").trim() === NAME_TO_PIN[name];
      if (!ok) {
        out.innerHTML = `<div class="danger">Wrong PIN.</div>`;
        return;
      }
      pinBlock.style.display = "none";
      showReveal();
    };
  } else {
    showReveal();
  }

  hint.innerHTML = `This is your personal link. Don‚Äôt share it.`;
}
</script>
</body>
</html>
